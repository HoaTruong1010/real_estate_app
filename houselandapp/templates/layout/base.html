<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Afforda{% endblock %}</title>
    <link rel="icon"
        href="https://res.cloudinary.com/doaux2ndg/image/upload/v1670076213/FlightMangement/icon-web_fgxmmq.png">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"
        integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.min.css">
    <link href="{{ url_for('static', filename='css/header.css') }}" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #manage {
            font-size: 45px;
            position: fixed;
            bottom: 170px;
            right: 50px;
            z-index: 1000;
            border: 1px solid #15a752;
            color: white;
            background-color: #15a752;
            border-radius: 5px;
            padding: 5px 13px;
        }

        #chat-icon {
            font-size: 75px;
            position: fixed;
            bottom: 50px;
            right: 50px;
            z-index: 1000;
            transition: color 1000ms linear;
            animation: gradient-animation 1s infinite linear;
        }

        #badge-admin {
            transition: background-color 1000ms linear;
            animation: gradient-animation 1s infinite linear;

        }

        @keyframes gradient-animation {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"
        integrity="sha512-luMnTJZ7oEchNDZAtQhgjomP1eZefnl82ruTH/3Oj/Yu5qYtwL7+dVRccACS/Snp1lFXq188XFipHKYE75IaQQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='js/contact.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script>
        const currentUser = `{{current_user.id}}`;
        const newBadge = `{{number_new_messages}}`;
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        $(document).ready(function () {
            const socket = io({ autoConnect: false });
            socket.connect();
            socket.on("connect", () => {
                socket.emit("user_join", "I'm connected!");
            });

            socket.on("handle_notify", (data) => {
                let magnageIcon = document.querySelector('#badge-admin');
                let badgeIcon = magnageIcon.querySelector("i");
                if (!badgeIcon) {
                    magnageIcon.innerHTML = `<i class="fas fa-exclamation-circle"></i>`;
                }
            });
            var c = ["transparent", "#007bff"], c1 = ["transparent", "#dc3545"];
            var index = 0, index1 = 0;

            function changeColor() {
                var animate = document.getElementById("chat-icon");
                if (index > c.length) {
                    index = 0;
                }

                animate.style.color = c[index];
                index++;
            }

            setInterval(changeColor, 1000);

            let exclamation = document.getElementById('badge-admin');
            if (exclamation) {
                setInterval(() => {
                    if (index1 > c1.length) {
                        index1 = 0;
                    }
                    exclamation.style.background = c1[index1];
                    index1++;
                }, 1000);
            }


            $("input[name='q']").keypress((e) => {
                if (e.which === 13) {
                    let q = $("input[name='q']").val();
                    let issales = $("#issales option:selected").val();
                    if (issales == 'true') {
                        $("form#search-form").attr('action', `/sales/all?q=${q}`);
                    }
                    else {
                        $("form#search-form").attr('action', `/rents/all?q=${q}`);
                    }
                }
            });
            $("#search_btn").click(() => {
                let q = $("input[name='q']").val();
                let issales = $("#issales option:selected").val();
                if (issales == 'true') {
                    $("form#search-form").attr('action', `/sales/all?q=${q}`);
                }
                else {
                    $("form#search-form").attr('action', `/rents/all?q=${q}`);
                }
            });

            const href = window.location.href.split("/");
            if (href[3] == '') {
                $('#home a').addClass('li-active');
                $('#sales button').removeClass('li-active');
                $('#rents button').removeClass('li-active');
            }
            else {
                if (href[3] == 'sales') {
                    $('#home a').removeClass('li-active');
                    $('#sales button').addClass('li-active');
                    $('#rents button').removeClass('li-active');
                }
                if (href[3] == 'rents') {
                    $('#home a').removeClass('li-active');
                    $('#sales button').removeClass('li-active');
                    $('#rents button').addClass('li-active');
                }
            }
        });
    </script>
    {% block css %}
    {% endblock %}
</head>

<body>
    {% block header %}
    {% include 'layout/header.html' %}
    {% endblock %}

    <div class="container">
        {% if current_user.is_authenticated %}
        <a class="nav-link" href="{{url_for('chat')}}">
            <i id="chat-icon" class="fas fa-comment-dots"
                style="font-size: 75px; position: fixed; bottom:50px; right:50px;  z-index:1000;"></i>
            <span class="badge badge-danger" id="badge-chat"
                style="font-size: 110%; position: fixed; bottom:110px; right:50px;  z-index:1000;">{% if
                number_new_messages > 0 %}{{number_new_messages}}{%endif%}</span>
        </a>
        {% if current_user.user_role == admin %}
        <a class="nav-link" href="/admin">
            <i id="manage" class="fas fa-tasks" title="Quản lý chung">
            </i>
            <span class="badge badge-danger" id="badge-admin"
                style="font-size: 110%; position: fixed; bottom:210px; right:35px;  z-index:1000;">
                {% if is_new_notify %}
                <i class="fas fa-exclamation-circle"></i>
                {%endif%}
            </span>
        </a>
        {%endif%}
        {%else%}
        <a class="nav-link" href="/login_register?next=/chat">
            <i id="chat-icon" class="fas fa-comment-dots"></i>
            <span class="badge badge-light" id="badge-chat"
                style="font-size: 110%; position: fixed; bottom:110px; right:50px;  z-index:1000;">{% if
                number_new_messages > 0 %}{{number_new_messages}}{%endif%}</span>
        </a>
        {%endif%}
        {% block content required %}{% endblock %}
    </div>

    {% block footer %}
    {% include 'layout/footer.html' %}
    {% endblock %}

    {% block js %}

    {% endblock %}
</body>

</html>